<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Podcast Stream - Ultimate</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            color: #333;
        }
        
        .container { max-width: 1400px; margin: 0 auto; }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #e74c3c;
        }
        
        .header h1 { font-size: 36px; color: #2c3e50; margin-bottom: 10px; }
        .header p { color: #7f8c8d; font-size: 16px; }
        
        /* Stats Banner */
        .stats-banner {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-box {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-box .number { font-size: 22px; font-weight: bold; color: #e74c3c; }
        .stat-box .label { font-size: 11px; color: #7f8c8d; margin-top: 5px; }
        
        /* Controls */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .search-bar {
            width: 100%;
            padding: 12px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .search-bar:focus { outline: none; border-color: #e74c3c; }
        
        .filters, .sort-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .filter-btn, .sort-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        .filter-btn:hover, .sort-btn:hover { border-color: #e74c3c; color: #e74c3c; }
        .filter-btn.active { background: #e74c3c; color: white; border-color: #e74c3c; }
        
        .sort-label { font-weight: 600; color: #555; align-self: center; }
        
        /* TWO COLUMN LAYOUT */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .video-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            position: relative;
        }
        
        .video-card:hover { transform: translateY(-4px); box-shadow: 0 4px 16px rgba(0,0,0,0.15); }
        
        /* Badges */
        .badge {
            position: absolute;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: bold;
            z-index: 15;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .new-badge { top: 10px; right: 10px; background: #e74c3c; color: white; }
        .trending-badge { top: 10px; left: 10px; background: #f39c12; color: white; }
        .episode-badge { top: 45px; right: 10px; background: #9b59b6; color: white; }
        .engagement-badge { top: 80px; right: 10px; background: #27ae60; color: white; }
        .discussion-badge { top: 45px; left: 10px; background: #e67e22; color: white; }
        
        .duration-badge {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            z-index: 15;
        }
        
        /* Thumbnail */
        .video-thumbnail {
            position: relative;
            padding-bottom: 56.25%;
            background: #000;
            cursor: pointer;
        }
        
        .video-thumbnail img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            background: rgba(231, 76, 60, 0.9);
            border-radius: 50%;
            z-index: 10;
        }
        
        .play-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 52%;
            transform: translate(-50%, -50%);
            width: 0;
            height: 0;
            border-left: 18px solid white;
            border-top: 11px solid transparent;
            border-bottom: 11px solid transparent;
        }
        
        .play-button:hover { background: rgba(231, 76, 60, 1); transform: translate(-50%, -50%) scale(1.1); }
        
        /* Content */
        .video-content { padding: 20px; }
        
        .video-title {
            font-size: 17px;
            font-weight: 600;
            line-height: 1.4;
            margin-bottom: 10px;
        }
        
        .video-title a {
            color: #2c3e50;
            text-decoration: none;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .video-title a:hover { color: #e74c3c; }
        
        .video-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .channel-name {
            font-weight: 600;
            color: #e74c3c;
            cursor: pointer;
        }
        
        .channel-name:hover { text-decoration: underline; }
        
        .channel-stats { font-size: 11px; color: #95a5a6; margin-bottom: 10px; }
        
        .stats-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 11px;
        }
        
        .stat-item { display: flex; align-items: center; gap: 4px; }
        
        .topic-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }
        
        .topic-tag {
            padding: 3px 8px;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .player-mentions {
            margin-top: 8px;
            font-size: 11px;
            color: #666;
            padding: 6px 8px;
            background: #fff3cd;
            border-radius: 4px;
        }
        
        .video-description {
            font-size: 12px;
            line-height: 1.5;
            color: #666;
            margin-top: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-left: 3px solid #e74c3c;
            border-radius: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .video-summary {
            font-size: 13px;
            line-height: 1.5;
            color: #555;
            margin-top: 10px;
            padding: 10px;
            background: #e8f4f8;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }
        
        .summary-label { font-weight: 600; color: #2980b9; margin-bottom: 5px; }
        
        .loading-spinner, .loading, .error, .no-videos {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }
        
        .error { color: #e74c3c; }
        
        @media (max-width: 1024px) {
            .video-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 28px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÄ NBA Podcast Stream</h1>
            <p>Latest episodes with advanced analytics</p>
        </div>

        <div class="stats-banner" id="statsBanner"></div>

        <div class="controls">
            <input 
                type="text" 
                class="search-bar" 
                id="searchBar" 
                placeholder="üîç Search title, channel, description, topics, players..."
            >
            
            <div class="filters">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="summaries">With Summaries</button>
                <button class="filter-btn" data-filter="trending">üî• Trending</button>
                <button class="filter-btn" data-filter="new">üÜï New Today</button>
                <button class="filter-btn" data-filter="hot-discussion">üí¨ Hot Discussion</button>
                <button class="filter-btn" data-filter="high-engagement">‚≠ê High Engagement</button>
            </div>

            <div class="sort-controls">
                <span class="sort-label">Sort:</span>
                <button class="sort-btn active" data-sort="date">Latest</button>
                <button class="sort-btn" data-sort="views">Views</button>
                <button class="sort-btn" data-sort="duration">Duration</button>
                <button class="sort-btn" data-sort="engagement">Engagement</button>
                <button class="sort-btn" data-sort="channel">Channel</button>
            </div>
        </div>

        <div id="videoGrid" class="video-grid">
            <div class="loading">Loading episodes...</div>
        </div>

        <div class="loading-spinner" id="loadingSpinner" style="display: none;">
            Loading more...
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRr8GiFRfKLquD0j49JqKIL11tnulG7--WeJsvP3nqFc72EeQM3RsQjnWeXlgcVoR2RL5y7oqYbfpSs/pub?gid=162816128&single=true&output=csv';
        const ITEMS_PER_LOAD = 10;
        
        const NBA_PLAYERS = ['LeBron', 'Curry', 'Durant', 'Giannis', 'Jokic', 'Embiid', 'Tatum', 'Luka', 'Harden', 'Booker', 'Davis', 'Butler', 'Lillard', 'Mitchell', 'Young', 'Morant', 'Edwards', 'Fox', 'Wembanyama', 'Shaq', 'Jordan', 'Kobe'];
        const NBA_TEAMS = ['Lakers', 'Warriors', 'Celtics', 'Heat', 'Bucks', 'Nuggets', 'Suns', 'Mavericks', 'Sixers', '76ers', 'Knicks', 'Clippers', 'Kings'];
        const TOPICS = ['Trade', 'Playoff', 'Draft', 'MVP', 'Championship', 'Finals', 'Injury', 'Analysis', 'Recap', 'Preview'];
        
        let allVideos = [];
        let filteredVideos = [];
        let displayedCount = ITEMS_PER_LOAD;
        let currentFilter = 'all';
        let currentSort = 'date';
        let searchQuery = '';
        let isLoading = false;
        let channelStats = {};
        
        function formatNumber(num) {
            const n = parseInt(num);
            if (isNaN(n)) return num;
            if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
            if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
            return n.toLocaleString();
        }
        
        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return 'Unknown';
                return date.toLocaleString('en-US', { 
                    month: 'short', day: 'numeric', year: 'numeric',
                    hour: 'numeric', minute: '2-digit', hour12: true
                });
            } catch { return 'Unknown'; }
        }
        
        function parseDuration(duration) {
            if (!duration) return 0;
            const parts = duration.split(':').map(Number);
            if (parts.length === 3) return parts[0] * 3600 + parts[1] * 60 + parts[2];
            if (parts.length === 2) return parts[0] * 60 + parts[1];
            return 0;
        }
        
        function isNew(dateString) {
            try {
                return (new Date() - new Date(dateString)) / (1000 * 60 * 60) < 24;
            } catch { return false; }
        }
        
        function isTrending(viewCount) { return parseInt(viewCount) > 50000; }
        
        function calculateEngagement(video) {
            const views = parseInt(video.viewCount) || 0;
            const likes = parseInt(video.likeCount) || 0;
            return views > 0 ? (likes / views) * 100 : 0;
        }
        
        function isHotDiscussion(video) {
            return parseInt(video.commentCount) > 500;
        }
        
        function extractEpisode(title) {
            const patterns = [/ep\.?\s*#?(\d+)/i, /episode\s*#?(\d+)/i, /#(\d+)/, /\[(\d+)\]/, /\((\d+)\)/];
            for (const pattern of patterns) {
                const match = title.match(pattern);
                if (match) return `EP ${match[1]}`;
            }
            return null;
        }
        
        function extractTopics(text) {
            if (!text) return [];
            return TOPICS.filter(t => text.toLowerCase().includes(t.toLowerCase())).slice(0, 5);
        }
        
        function detectPlayers(text) {
            if (!text) return {};
            const mentions = {};
            NBA_PLAYERS.forEach(player => {
                const matches = text.match(new RegExp(player, 'gi'));
                if (matches) mentions[player] = matches.length;
            });
            return mentions;
        }
        
        function detectTeams(text) {
            if (!text) return [];
            return [...new Set(NBA_TEAMS.filter(team => text.toLowerCase().includes(team.toLowerCase())))];
        }
        
        function calculateChannelStats(videos) {
            const stats = {};
            videos.forEach(video => {
                const channel = video.channelName;
                if (!stats[channel]) {
                    stats[channel] = { count: 0, totalDuration: 0, videos: [] };
                }
                stats[channel].count++;
                stats[channel].totalDuration += parseDuration(video.duration);
                stats[channel].videos.push(new Date(video.publishedDate));
            });
            
            Object.keys(stats).forEach(channel => {
                const data = stats[channel];
                data.avgDuration = data.totalDuration / data.count;
                if (data.videos.length > 1) {
                    data.videos.sort((a, b) => a - b);
                    const daysDiff = (data.videos[data.videos.length - 1] - data.videos[0]) / (1000 * 60 * 60 * 24);
                    data.frequency = daysDiff > 0 ? (data.count / (daysDiff / 7)) : data.count;
                }
            });
            
            return stats;
        }
        
        function playVideo(videoId, event) {
            event.preventDefault();
            event.stopPropagation();
            window.open(`https://www.youtube.com/watch?v=${videoId}`, '_blank');
        }
        
        function createVideoCard(video, index) {
            const engagement = calculateEngagement(video);
            const hotDiscussion = isHotDiscussion(video);
            const episodeNum = extractEpisode(video.title);
            
            const fullText = `${video.title} ${video.description}`;
            const topics = extractTopics(fullText);
            const players = detectPlayers(fullText);
            const teams = detectTeams(fullText);
            
            const topPlayers = Object.entries(players).sort((a, b) => b[1] - a[1]).slice(0, 3);
            
            const channelStat = channelStats[video.channelName];
            let channelInfo = '';
            if (channelStat) {
                const avgMin = Math.floor(channelStat.avgDuration / 60);
                const freq = channelStat.frequency ? `${channelStat.frequency.toFixed(1)}x/week` : '';
                channelInfo = `<div class="channel-stats">Avg: ${avgMin}min ‚Ä¢ ${freq}</div>`;
            }
            
            return `
                <div class="video-card">
                    ${isNew(video.publishedDate) ? '<div class="badge new-badge">NEW</div>' : ''}
                    ${isTrending(video.viewCount) ? '<div class="badge trending-badge">üî• TRENDING</div>' : ''}
                    ${episodeNum ? `<div class="badge episode-badge">${episodeNum}</div>` : ''}
                    ${engagement > 5 ? `<div class="badge engagement-badge">‚≠ê ${engagement.toFixed(1)}%</div>` : ''}
                    ${hotDiscussion ? '<div class="badge discussion-badge">üî• Hot</div>' : ''}
                    
                    <div class="video-thumbnail" onclick="playVideo('${video.id}', event)">
                        <img src="${video.thumbnail}" alt="${video.title}">
                        ${video.duration ? `<div class="duration-badge">‚è±Ô∏è ${video.duration}</div>` : ''}
                        <div class="play-button"></div>
                    </div>
                    
                    <div class="video-content">
                        <h3 class="video-title">
                            <a href="https://www.youtube.com/watch?v=${video.id}" target="_blank">${video.title}</a>
                        </h3>
                        <div class="video-meta">
                            <span class="channel-name">${video.channelName}</span>
                            <span>üìÖ ${formatDate(video.publishedDate)}</span>
                        </div>
                        ${channelInfo}
                        <div class="stats-row">
                            <div class="stat-item">üëÅÔ∏è <strong>${formatNumber(video.viewCount)}</strong></div>
                            <div class="stat-item">üë• <strong>${formatNumber(video.subscriberCount)}</strong></div>
                            <div class="stat-item">üëç <strong>${formatNumber(video.likeCount)}</strong></div>
                            <div class="stat-item">üí¨ <strong>${formatNumber(video.commentCount)}</strong></div>
                        </div>
                        ${topics.length > 0 ? `<div class="topic-tags">${topics.map(t => `<span class="topic-tag">#${t}</span>`).join('')}</div>` : ''}
                        ${topPlayers.length > 0 ? `<div class="player-mentions">üèÄ ${topPlayers.map(([n, c]) => `${n} (${c})`).join(', ')}</div>` : ''}
                        ${teams.length > 0 ? `<div class="player-mentions">üèÜ Teams: ${teams.slice(0, 3).join(', ')}</div>` : ''}
                        ${video.description ? `<div class="video-description">${video.description.substring(0, 200)}...</div>` : ''}
                        ${video.summary ? `<div class="video-summary"><div class="summary-label">ü§ñ AI Summary:</div>${video.summary}</div>` : ''}
                    </div>
                </div>
            `;
        }
        
        function createStatsBanner(videos) {
            const totalViews = videos.reduce((sum, v) => sum + (parseInt(v.viewCount) || 0), 0);
            const withTranscripts = videos.filter(v => v.transcriptAvailable === 'Yes').length;
            const uniqueChannels = new Set(videos.map(v => v.channelId)).size;
            const totalSeconds = videos.reduce((sum, v) => sum + parseDuration(v.duration), 0);
            const avgEngagement = videos.reduce((sum, v) => sum + calculateEngagement(v), 0) / videos.length;
            
            const allTopics = {};
            videos.forEach(v => {
                extractTopics(`${v.title} ${v.description}`).forEach(t => {
                    allTopics[t] = (allTopics[t] || 0) + 1;
                });
            });
            const topTopic = Object.entries(allTopics).sort((a, b) => b[1] - a[1])[0];
            
            return `
                <div class="stat-box"><div class="number">${videos.length}</div><div class="label">Episodes</div></div>
                <div class="stat-box"><div class="number">${formatNumber(totalViews)}</div><div class="label">Total Views</div></div>
                <div class="stat-box"><div class="number">${uniqueChannels}</div><div class="label">Podcasts</div></div>
                <div class="stat-box"><div class="number">${withTranscripts}</div><div class="label">With Summaries</div></div>
                <div class="stat-box"><div class="number">${Math.floor(totalSeconds / 3600)}h ${Math.floor((totalSeconds % 3600) / 60)}m</div><div class="label">Total Content</div></div>
                <div class="stat-box"><div class="number">${avgEngagement.toFixed(1)}%</div><div class="label">Avg Engagement</div></div>
                ${topTopic ? `<div class="stat-box"><div class="number">#${topTopic[0]}</div><div class="label">Top Topic</div></div>` : ''}
            `;
        }
        
        function filterVideos() {
            let result = allVideos;
            
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                result = result.filter(v => {
                    const fullText = `${v.title} ${v.channelName} ${v.description}`.toLowerCase();
                    const topics = extractTopics(fullText).join(' ').toLowerCase();
                    const players = Object.keys(detectPlayers(fullText)).join(' ').toLowerCase();
                    return fullText.includes(query) || topics.includes(query) || players.includes(query);
                });
            }
            
            switch(currentFilter) {
                case 'summaries': result = result.filter(v => v.transcriptAvailable === 'Yes'); break;
                case 'trending': result = result.filter(v => isTrending(v.viewCount)); break;
                case 'new': result = result.filter(v => isNew(v.publishedDate)); break;
                case 'hot-discussion': result = result.filter(v => isHotDiscussion(v)); break;
                case 'high-engagement': result = result.filter(v => calculateEngagement(v) > 5); break;
            }
            
            switch(currentSort) {
                case 'views': result.sort((a, b) => parseInt(b.viewCount) - parseInt(a.viewCount)); break;
                case 'duration': result.sort((a, b) => parseDuration(b.duration) - parseDuration(a.duration)); break;
                case 'engagement': result.sort((a, b) => calculateEngagement(b) - calculateEngagement(a)); break;
                case 'channel': result.sort((a, b) => a.channelName.localeCompare(b.channelName)); break;
                default: result.sort((a, b) => new Date(b.publishedDate) - new Date(a.publishedDate));
            }
            
            filteredVideos = result;
            displayedCount = ITEMS_PER_LOAD;
            renderVideos();
        }
        
        function renderVideos() {
            const grid = document.getElementById('videoGrid');
            const videosToShow = filteredVideos.slice(0, displayedCount);
            
            if (videosToShow.length === 0) {
                grid.innerHTML = '<div class="no-videos">No episodes found.</div>';
                return;
            }
            
            grid.innerHTML = videosToShow.map((video, i) => createVideoCard(video, i)).join('');
        }
        
        function handleScroll() {
            if (isLoading) return;
            const scrollPos = window.innerHeight + window.scrollY;
            const pageHeight = document.documentElement.scrollHeight;
            
            if (scrollPos >= pageHeight - 500 && displayedCount < filteredVideos.length) {
                isLoading = true;
                document.getElementById('loadingSpinner').style.display = 'block';
                setTimeout(() => {
                    displayedCount += ITEMS_PER_LOAD;
                    renderVideos();
                    isLoading = false;
                    document.getElementById('loadingSpinner').style.display = 'none';
                }, 500);
            }
        }
        
        async function loadVideos() {
            try {
                const response = await fetch(SHEET_CSV_URL);
                if (!response.ok) throw new Error('Failed to fetch');
                
                const csvText = await response.text();
                const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });
                
                if (!parsed.data || parsed.data.length === 0) {
                    document.getElementById('videoGrid').innerHTML = '<div class="no-videos">No videos yet.</div>';
                    return;
                }
                
                allVideos = parsed.data.map(row => ({
                    id: row['Video ID'],
                    title: row['Title'],
                    channelName: row['Channel Name'],
                    channelId: row['Channel ID'],
                    publishedDate: row['Published Date'],
                    thumbnail: row['Thumbnail URL'],
                    description: row['Description'] || '',
                    viewCount: row['View Count'] || '0',
                    subscriberCount: row['Subscriber Count'] || 'N/A',
                    duration: row['Duration'] || '',
                    likeCount: row['Like Count'] || '0',
                    commentCount: row['Comment Count'] || '0',
                    transcriptAvailable: row['Transcript Available'] || 'No',
                    summary: row['AI Summary'] || ''
                })).filter(v => v.id);
                
                channelStats = calculateChannelStats(allVideos);
                document.getElementById('statsBanner').innerHTML = createStatsBanner(allVideos);
                filterVideos();
            } catch (error) {
                document.getElementById('videoGrid').innerHTML = `<div class="error">Unable to load: ${error.message}</div>`;
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            loadVideos();
            
            let searchTimeout;
            document.getElementById('searchBar').addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    searchQuery = e.target.value;
                    filterVideos();
                }, 300);
            });
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    filterVideos();
                });
            });
            
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentSort = btn.dataset.sort;
                    filterVideos();
                });
            });
            
            window.addEventListener('scroll', handleScroll);
        });
        
        setInterval(loadVideos, 60 * 60 * 1000);
    </script>
</body>
</html>
